<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Planner - Housing Mix</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            margin-bottom: 10px;
            color: #4ade80;
        }
        .subtitle {
            color: #888;
            margin-bottom: 30px;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .control-group {
            background: #252540;
            padding: 20px;
            border-radius: 12px;
        }
        .control-group h3 {
            margin-bottom: 15px;
            color: #4ade80;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .slider-row {
            margin-bottom: 15px;
        }
        .slider-row label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .slider-row input[type="range"] {
            width: 100%;
            accent-color: #4ade80;
        }
        .value {
            color: #4ade80;
            font-weight: bold;
        }
        .chart-container {
            background: #252540;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .chart-header h2 {
            font-size: 18px;
        }
        .legend {
            display: flex;
            gap: 20px;
            font-size: 12px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        .chart {
            position: relative;
            height: 300px;
            border-left: 2px solid #444;
            border-bottom: 2px solid #444;
            margin-left: 50px;
            margin-bottom: 30px;
        }
        .y-axis {
            position: absolute;
            left: -50px;
            top: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 11px;
            color: #888;
        }
        .x-axis {
            display: flex;
            justify-content: space-between;
            margin-left: 50px;
            font-size: 11px;
            color: #888;
        }
        .bar-group {
            position: absolute;
            bottom: 0;
            display: flex;
            flex-direction: column-reverse;
            width: 60px;
            margin-left: -30px;
        }
        .bar-segment {
            width: 100%;
            transition: height 0.3s ease;
        }
        .target-line {
            position: absolute;
            left: 0;
            right: 0;
            border-top: 2px dashed #f59e0b;
            z-index: 10;
        }
        .target-label {
            position: absolute;
            right: 5px;
            top: -20px;
            font-size: 11px;
            color: #f59e0b;
        }
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .summary-card {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .summary-value {
            font-size: 28px;
            font-weight: bold;
            color: #4ade80;
        }
        .summary-label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        .summary-card.warning .summary-value {
            color: #f59e0b;
        }
        .summary-card.danger .summary-value {
            color: #ef4444;
        }
        .ratio-bar {
            height: 20px;
            background: #1a1a2e;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            margin-top: 10px;
        }
        .ratio-segment {
            height: 100%;
            transition: width 0.3s ease;
        }
        .housing-breakdown {
            margin-top: 20px;
            font-size: 13px;
        }
        .housing-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }
        .housing-row:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Resource Planner</h1>
        <p class="subtitle">Adjust housing mix to see seasonal resource availability</p>

        <div class="controls">
            <div class="control-group">
                <h3>Single-Family Homes</h3>
                <div class="slider-row">
                    <label>
                        <span>Owned (with yards)</span>
                        <span class="value" id="sf-owned-val">10</span>
                    </label>
                    <input type="range" id="sf-owned" min="0" max="50" value="10">
                </div>
                <div class="slider-row">
                    <label>
                        <span>Rented (no yard access)</span>
                        <span class="value" id="sf-rented-val">5</span>
                    </label>
                    <input type="range" id="sf-rented" min="0" max="50" value="5">
                </div>
            </div>

            <div class="control-group">
                <h3>Multi-Family Units</h3>
                <div class="slider-row">
                    <label>
                        <span>Condos (attached)</span>
                        <span class="value" id="condos-val">6</span>
                    </label>
                    <input type="range" id="condos" min="0" max="100" value="6">
                </div>
                <div class="slider-row">
                    <label>
                        <span>Apartments</span>
                        <span class="value" id="apartments-val">0</span>
                    </label>
                    <input type="range" id="apartments" min="0" max="100" value="0">
                </div>
            </div>

            <div class="control-group">
                <h3>System Capacity</h3>
                <div class="slider-row">
                    <label>
                        <span>Target throughput (gal/week)</span>
                        <span class="value" id="target-val">120</span>
                    </label>
                    <input type="range" id="target" min="60" max="240" step="10" value="120">
                </div>
                <p style="font-size: 12px; color: #888; margin-top: 10px;">
                    64 cu ft system = 120 gal/week<br>
                    Ideal ratio: 2:1 browns:greens by volume
                </p>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <h2>Seasonal Resource Availability</h2>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #d97706;"></div>
                        <span>Cardboard (brown)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #22c55e;"></div>
                        <span>Food Waste (green)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #86efac;"></div>
                        <span>Grass (green)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fbbf24;"></div>
                        <span>Leaves (brown)</span>
                    </div>
                </div>
            </div>
            <div class="chart" id="chart">
                <div class="y-axis" id="y-axis"></div>
                <div class="target-line" id="target-line">
                    <span class="target-label">Target</span>
                </div>
            </div>
            <div class="x-axis" id="x-axis"></div>
        </div>

        <div class="chart-container">
            <h2 style="margin-bottom: 15px;">Browns:Greens Ratio (by volume)</h2>
            <div class="ratio-bar" id="ratio-bar"></div>
            <p id="ratio-text" style="margin-top: 10px; font-size: 14px;"></p>
        </div>

        <div class="chart-container">
            <div class="summary" id="summary"></div>
        </div>

        <div class="chart-container">
            <h2 style="margin-bottom: 15px;">Housing Breakdown</h2>
            <div class="housing-breakdown" id="housing-breakdown"></div>
        </div>
    </div>

    <script>
        // Housing type resource profiles (gallons per week)
        const HOUSING_PROFILES = {
            sfOwned: {
                name: 'Single-Family (Owned)',
                cardboard: 6,
                food: 2.5,
                grass: { apr: 4, may: 5, jun: 5, jul: 4, aug: 4, sep: 4, oct: 3 },
                leaves: { oct: 15, nov: 25 },
                yardSpace: true,
                compostBuyer: true
            },
            sfRented: {
                name: 'Single-Family (Rented)',
                cardboard: 6,
                food: 2.5,
                grass: {},
                leaves: {},
                yardSpace: false,
                compostBuyer: false
            },
            condo: {
                name: 'Condo (Attached)',
                cardboard: 4,
                food: 2,
                grass: {},
                leaves: {},
                yardSpace: false,
                compostBuyer: true  // May have planters
            },
            apartment: {
                name: 'Apartment',
                cardboard: 3,
                food: 1.5,
                grass: {},
                leaves: {},
                yardSpace: false,
                compostBuyer: false
            }
        };

        const MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const MONTH_KEYS = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];

        // Get slider values
        function getInputs() {
            return {
                sfOwned: parseInt(document.getElementById('sf-owned').value),
                sfRented: parseInt(document.getElementById('sf-rented').value),
                condos: parseInt(document.getElementById('condos').value),
                apartments: parseInt(document.getElementById('apartments').value),
                target: parseInt(document.getElementById('target').value)
            };
        }

        // Calculate resources for a given month
        function calculateMonthlyResources(inputs, monthKey) {
            const resources = { cardboard: 0, food: 0, grass: 0, leaves: 0 };

            // Single-family owned
            resources.cardboard += inputs.sfOwned * HOUSING_PROFILES.sfOwned.cardboard;
            resources.food += inputs.sfOwned * HOUSING_PROFILES.sfOwned.food;
            resources.grass += inputs.sfOwned * (HOUSING_PROFILES.sfOwned.grass[monthKey] || 0);
            resources.leaves += inputs.sfOwned * (HOUSING_PROFILES.sfOwned.leaves[monthKey] || 0);

            // Single-family rented
            resources.cardboard += inputs.sfRented * HOUSING_PROFILES.sfRented.cardboard;
            resources.food += inputs.sfRented * HOUSING_PROFILES.sfRented.food;

            // Condos
            resources.cardboard += inputs.condos * HOUSING_PROFILES.condo.cardboard;
            resources.food += inputs.condos * HOUSING_PROFILES.condo.food;

            // Apartments
            resources.cardboard += inputs.apartments * HOUSING_PROFILES.apartment.cardboard;
            resources.food += inputs.apartments * HOUSING_PROFILES.apartment.food;

            return resources;
        }

        // Calculate annual averages and totals
        function calculateAnnualStats(inputs) {
            let totalBrowns = 0, totalGreens = 0;
            let minWeek = Infinity, maxWeek = 0;
            let peakMonth = '', lowMonth = '';

            MONTH_KEYS.forEach((monthKey, i) => {
                const r = calculateMonthlyResources(inputs, monthKey);
                const browns = r.cardboard + r.leaves;
                const greens = r.food + r.grass;
                const total = browns + greens;

                totalBrowns += browns * 4; // 4 weeks per month
                totalGreens += greens * 4;

                if (total > maxWeek) { maxWeek = total; peakMonth = MONTHS[i]; }
                if (total < minWeek) { minWeek = total; lowMonth = MONTHS[i]; }
            });

            return {
                totalBrowns,
                totalGreens,
                avgWeekly: (totalBrowns + totalGreens) / 52,
                ratio: totalGreens > 0 ? (totalBrowns / totalGreens).toFixed(1) : 'N/A',
                peakMonth,
                lowMonth,
                minWeek,
                maxWeek
            };
        }

        // Render the chart
        function renderChart() {
            const inputs = getInputs();
            const chart = document.getElementById('chart');
            const yAxis = document.getElementById('y-axis');
            const xAxis = document.getElementById('x-axis');

            // Clear existing bars
            chart.querySelectorAll('.bar-group').forEach(el => el.remove());

            // Calculate max for scaling
            let maxTotal = 0;
            MONTH_KEYS.forEach(monthKey => {
                const r = calculateMonthlyResources(inputs, monthKey);
                const total = r.cardboard + r.food + r.grass + r.leaves;
                if (total > maxTotal) maxTotal = total;
            });
            maxTotal = Math.max(maxTotal, inputs.target) * 1.2; // Add 20% headroom

            // Y-axis labels
            yAxis.innerHTML = '';
            for (let i = 5; i >= 0; i--) {
                const val = Math.round(maxTotal * i / 5);
                const label = document.createElement('span');
                label.textContent = val;
                yAxis.appendChild(label);
            }

            // Target line position
            const targetLine = document.getElementById('target-line');
            const targetPercent = (inputs.target / maxTotal) * 100;
            targetLine.style.bottom = targetPercent + '%';

            // Create bars for each month
            const chartWidth = chart.offsetWidth;
            const barSpacing = chartWidth / 12;

            MONTH_KEYS.forEach((monthKey, i) => {
                const r = calculateMonthlyResources(inputs, monthKey);
                const total = r.cardboard + r.food + r.grass + r.leaves;

                const barGroup = document.createElement('div');
                barGroup.className = 'bar-group';
                barGroup.style.left = (barSpacing * i + barSpacing / 2) + 'px';

                // Stack: cardboard (bottom), food, grass, leaves (top)
                const segments = [
                    { value: r.cardboard, color: '#d97706' },  // Orange-brown for cardboard
                    { value: r.food, color: '#22c55e' },       // Bright green for food
                    { value: r.grass, color: '#86efac' },      // Light green for grass
                    { value: r.leaves, color: '#fbbf24' }      // Yellow-gold for leaves
                ];

                segments.forEach(seg => {
                    if (seg.value > 0) {
                        const segEl = document.createElement('div');
                        segEl.className = 'bar-segment';
                        segEl.style.background = seg.color;
                        segEl.style.height = ((seg.value / maxTotal) * 300) + 'px';
                        barGroup.appendChild(segEl);
                    }
                });

                chart.appendChild(barGroup);
            });

            // X-axis labels
            xAxis.innerHTML = MONTHS.map(m => `<span>${m}</span>`).join('');
        }

        // Render ratio bar
        function renderRatio() {
            const inputs = getInputs();
            const stats = calculateAnnualStats(inputs);
            const ratioBar = document.getElementById('ratio-bar');
            const ratioText = document.getElementById('ratio-text');

            const total = stats.totalBrowns + stats.totalGreens;
            const brownsPercent = total > 0 ? (stats.totalBrowns / total) * 100 : 50;
            const greensPercent = 100 - brownsPercent;

            ratioBar.innerHTML = `
                <div class="ratio-segment" style="width: ${brownsPercent}%; background: linear-gradient(90deg, #d97706, #fbbf24);"></div>
                <div class="ratio-segment" style="width: ${greensPercent}%; background: linear-gradient(90deg, #22c55e, #86efac);"></div>
            `;

            const ratio = parseFloat(stats.ratio);
            let status = '';
            if (ratio >= 1.8 && ratio <= 2.2) {
                status = '(ideal)';
            } else if (ratio > 2.2) {
                status = '(browns heavy - add more greens or get external food waste)';
            } else if (ratio < 1.8 && ratio > 0) {
                status = '(greens heavy - need more cardboard/leaves)';
            }

            ratioText.innerHTML = `<strong>${stats.ratio}:1</strong> Browns to Greens ${status}`;
        }

        // Render summary cards
        function renderSummary() {
            const inputs = getInputs();
            const stats = calculateAnnualStats(inputs);
            const totalUnits = inputs.sfOwned + inputs.sfRented + inputs.condos + inputs.apartments;

            const summary = document.getElementById('summary');

            const avgStatus = stats.avgWeekly >= inputs.target * 0.9 ? '' :
                             stats.avgWeekly >= inputs.target * 0.7 ? 'warning' : 'danger';

            summary.innerHTML = `
                <div class="summary-card">
                    <div class="summary-value">${totalUnits}</div>
                    <div class="summary-label">Total Households</div>
                </div>
                <div class="summary-card ${avgStatus}">
                    <div class="summary-value">${Math.round(stats.avgWeekly)}</div>
                    <div class="summary-label">Avg gal/week (target: ${inputs.target})</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value">${Math.round(stats.minWeek)}</div>
                    <div class="summary-label">Low (${stats.lowMonth})</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value">${Math.round(stats.maxWeek)}</div>
                    <div class="summary-label">Peak (${stats.peakMonth})</div>
                </div>
            `;
        }

        // Render housing breakdown
        function renderHousingBreakdown() {
            const inputs = getInputs();
            const breakdown = document.getElementById('housing-breakdown');

            const rows = [
                { name: HOUSING_PROFILES.sfOwned.name, count: inputs.sfOwned,
                  weekly: inputs.sfOwned * (HOUSING_PROFILES.sfOwned.cardboard + HOUSING_PROFILES.sfOwned.food),
                  hasYard: true },
                { name: HOUSING_PROFILES.sfRented.name, count: inputs.sfRented,
                  weekly: inputs.sfRented * (HOUSING_PROFILES.sfRented.cardboard + HOUSING_PROFILES.sfRented.food),
                  hasYard: false },
                { name: HOUSING_PROFILES.condo.name, count: inputs.condos,
                  weekly: inputs.condos * (HOUSING_PROFILES.condo.cardboard + HOUSING_PROFILES.condo.food),
                  hasYard: false },
                { name: HOUSING_PROFILES.apartment.name, count: inputs.apartments,
                  weekly: inputs.apartments * (HOUSING_PROFILES.apartment.cardboard + HOUSING_PROFILES.apartment.food),
                  hasYard: false }
            ];

            breakdown.innerHTML = rows.map(r => `
                <div class="housing-row">
                    <span>${r.name}</span>
                    <span>${r.count} units = ${Math.round(r.weekly)} gal/week base ${r.hasYard ? '+ seasonal grass/leaves' : ''}</span>
                </div>
            `).join('');
        }

        // Update displays for slider values
        function updateSliderDisplays() {
            document.getElementById('sf-owned-val').textContent = document.getElementById('sf-owned').value;
            document.getElementById('sf-rented-val').textContent = document.getElementById('sf-rented').value;
            document.getElementById('condos-val').textContent = document.getElementById('condos').value;
            document.getElementById('apartments-val').textContent = document.getElementById('apartments').value;
            document.getElementById('target-val').textContent = document.getElementById('target').value;
        }

        // Main update function
        function update() {
            updateSliderDisplays();
            renderChart();
            renderRatio();
            renderSummary();
            renderHousingBreakdown();
        }

        // Event listeners
        document.querySelectorAll('input[type="range"]').forEach(input => {
            input.addEventListener('input', update);
        });

        // Handle resize
        window.addEventListener('resize', renderChart);

        // Initial render
        update();
    </script>
</body>
</html>
